<html>

<head>
    <title>docs.microsoft.com Table of Content Helper - PoC</title>
    <script type="text/javascript" src="includes/toc-helper.js"></script>
    <link rel="stylesheet" type="text/css" href="includes/toc-helper.css" />

    <script src="assets/fancytree/lib/jquery.js"></script>

    <link href="assets/fancytree/src/skin-win8/ui.fancytree.css" rel="stylesheet">
    <script src="assets/fancytree/src/jquery-ui-dependencies/jquery.fancytree.ui-deps.js"></script>
    <script src="assets/fancytree/src/jquery.fancytree.js"></script>
    <script src="assets/fancytree/src/jquery.fancytree.dnd5.js"></script>
    <script src="assets/fancytree/src/jquery.fancytree.edit.js"></script>
    <script src="assets/fancytree/src/jquery.fancytree.filter.js"></script>

    <style type="text/css">
        span.drag-source {
            border: 1px solid grey;
            border-radius: 3px;
            padding: 2px;
            background-color: silver
        }

        ul.fancytree-container {
            max-height: 200px;
            overflow-y: scroll;
        }

        span.fancytree-node.fancytree-drag-source {
            outline: 1px dotted grey;
        }

        /*
        span.fancytree-node.fancytree-drag-source.fancytree-drag-remove {
          opacity: 0.4;
        }
        span.fancytree-node.fancytree-drop-over {
          outline: 1px solid gray;
        }
      */

        span.fancytree-node.fancytree-drop-accept {
            outline: 1px dotted green;
        }

        span.fancytree-node.fancytree-drop-reject {
            outline: 1px dotted red;
        }
    </style>

    <!-- Initialize the tree when page is loaded -->
    <script type="text/javascript">
        $(function () { // on page load
            // Create the tree inside the <div id="tree"> element.
            $("#tree").fancytree({
                icon: true,
                selectMode: 2,
                extensions: ["edit", "filter", "dnd5"],
                source: [{
                        title: "Node 1",
                        key: "1"
                    },
                    {
                        title: "Folder 2",
                        key: "2",
                        folder: true,
                        children: [{
                                title: "Node 2.1",
                                key: "3"
                            },
                            {
                                title: "Node 2.2",
                                key: "4"
                            }
                        ]
                    }
                ],
                dnd5: {
                    // autoExpandMS: 400,
                    // preventForeignNodes: true,
                    // preventNonNodes: true,
                    // preventRecursiveMoves: true, // Prevent dropping nodes on own descendants
                    // preventVoidMoves: true, // Prevent dropping nodes 'before self', etc.
                    // scroll: true,
                    // scrollSpeed: 7,
                    // scrollSensitivity: 10,

                    // --- Drag-support:

                    dragStart: function (node, data) {
                        /* This function MUST be defined to enable dragging for the tree.
                         *
                         * Return false to cancel dragging of node.
                         * data.dataTransfer.setData() and .setDragImage() is available
                         * here.
                         */
                        //          data.dataTransfer.setDragImage($("<div>hurz</div>").appendTo("body")[0], -10, -10);
                        return true;
                    },
                    dragDrag: function (node, data) {
                        data.dataTransfer.dropEffect = "move";
                    },
                    dragEnd: function (node, data) {},

                    // --- Drop-support:

                    dragEnter: function (node, data) {
                        // node.debug("dragEnter", data);
                        data.dataTransfer.dropEffect = "move";
                        // data.dataTransfer.effectAllowed = "copy";
                        return true;
                    },
                    dragOver: function (node, data) {
                        data.dataTransfer.dropEffect = "move";
                        // data.dataTransfer.effectAllowed = "copy";
                    },
                    dragLeave: function (node, data) {},
                    dragDrop: function (node, data) {
                        /* This function MUST be defined to enable dropping of items on
                         * the tree.
                         */
                        var transfer = data.dataTransfer;

                        node.debug("drop", data);

                        // alert("Drop on " + node + ":\n"
                        //   + "source:" + JSON.stringify(data.otherNodeData) + "\n"
                        //   + "hitMode:" + data.hitMode
                        //   + ", dropEffect:" + transfer.dropEffect
                        //   + ", effectAllowed:" + transfer.effectAllowed);

                        if (data.otherNode) {
                            // Drop another Fancytree node from same frame
                            // (maybe from another tree however)
                            var sameTree = (data.otherNode.tree === data.tree);

                            data.otherNode.moveTo(node, data.hitMode);
                        } else if (data.otherNodeData) {
                            // Drop Fancytree node from different frame or window, so we only have
                            // JSON representation available
                            node.addChild(data.otherNodeData, data.hitMode);
                        } else {
                            // Drop a non-node
                            node.addNode({
                                title: transfer.getData("text")
                            }, data.hitMode);
                        }
                        node.setExpanded();
                    }
                },
                activate: function (event, data) {
                    //        alert("activate " + data.node);
                },
                lazyLoad: function (event, data) {
                    data.result = {
                        url: "ajax-sub2.json"
                    }
                },
                edit: {
                    triggerStart: ["clickActive", "dblclick", "f2", "mac+enter", "shift+click"],
                    beforeEdit: function (event, data) {
                        // Return false to prevent edit mode
                    },
                    edit: function (event, data) {
                        // Editor was opened (available as data.input)
                    },
                    beforeClose: function (event, data) {
                        // Return false to prevent cancel/save (data.input is available)
                        console.log(event.type, event, data);
                        if (data.originalEvent.type === "mousedown") {
                            // We could prevent the mouse click from generating a blur event
                            // (which would then again close the editor) and return `false` to keep
                            // the editor open:
                            //                  data.originalEvent.preventDefault();
                            //                  return false;
                            // Or go on with closing the editor, but discard any changes:
                            //                  data.save = false;
                        }
                    },
                    save: function (event, data) {
                        // Save data.input.val() or return false to keep editor open
                        console.log("save...", this, data);
                        // Simulate to start a slow ajax request...
                        setTimeout(function () {
                            $(data.node.span).removeClass("pending");
                            // Let's pretend the server returned a slightly modified
                            // title:
                            data.node.setTitle(data.node.title + "!");
                        }, 2000);
                        // We return true, so ext-edit will set the current user input
                        // as title
                        return true;
                    },
                    close: function (event, data) {
                        // Editor was removed
                        if (data.save) {
                            // Since we started an async request, mark the node as preliminary
                            $(data.node.span).addClass("pending");
                        }
                    }
                }
            });
            // Note: Loading and initialization may be asynchronous, so the nodes may not be accessible yet.
        });
    </script>
</head>

<body>
    <div id="container">
        <div id="tree_wrapper">
            <button onclick="makeCode()">Tree > Code</button>
            <div id="tree"> </div>
        </div>
        <div id="code_wrapper">
            <button class="" onclick="updateTree()">Tree &lt; Code</button>
            <div id="code">
                <textarea>Code Content</textarea>
            </div>
        </div>
        <div style="float: none;" />
    </div>
</body>

</html>